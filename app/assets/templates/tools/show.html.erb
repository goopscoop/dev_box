<div class="row">
  <div class="col m3  blue-grey darken-4 mySidebar">
    <h3 class="pink-text">Browse the Toolbox</h3>
    <div class="divider"></div>
    <h4>Category</h4>
    <ul ng-repeat="cat in categories">
        <li><a ng-href="/tools/?c={{cat.category}}" ng-click="addCat(cat.category)">{{cat.category}}</a></li>
    </ul>
    <div class="divider"></div>
    <h4>Popular Tags</h4>
    <ul ng-repeat="tag in tags">
        <li><a ng-href="/tools/?t={{tag.tag}}" ng-click="addTag(tag.tag)">{{tag.tag}}</a></li>
    </ul>
  </div>
  <div class="col s12 m7 offset-m4 card-panel blue-grey darken-1">

    <div class="row">
      <div class="col m1">
        <br>
        <br>
        <a ng-if="$root.isAuthenticated" ng-click="addTool(tool.tool.id)" class="btn-floating waves-effect waves-light pink">
          <i ng-class="{'mdi-content-add': tool.favorited === false, 'mdi-content-clear': tool.favorited === true}"></i>
          <md-tooltip ng-if="tool.favorited === true">remove from your toolbox</md-tooltip>
          <md-tooltip ng-if="tool.favorited === false">add to your toolbox</md-tooltip>
        </a>
        <a ng-if="$root.isAuthenticated === false" class="btn-floating waves-effect waves-light pink">
          <i class="mdi-content-add"></i>
          <md-tooltip>log in to add to toolbox</md-tooltip>
        </a>
      </div>
      <div class="col m7">
        <h2>{{tool.tool.title}} </h2>
      </div>
      <div class="col m4">
        <br>
        <div class="col m5">
          <span class="avg-review-tag">avg. user rating</span>
        </div>
        <div class="col m7">
          <span ng-repeat="i in getNumber(number) track by $index">
            <i ng-if="tool.tool.avg_rating >= $index + 1" id={{$index}} class="small mdi-hardware-mouse liked"></i>
            <i ng-if="tool.tool.avg_rating < $index + 1" id={{$index}} class="small mdi-hardware-mouse"></i>
          </span>
        </div>
        <div class="col m5">
          <span class="avg-review-tag">your rating</span>
        </div>
        <div class="col m7">
          <span ng-repeat="i in getNumber(number) track by $index">
            <i ng-if="userRating >= $index + 1" ng-mouseenter="displayRating($index)" ng-mouseleave="resetRatingDisplay()" ng-click="setRating($index)" id={{$index}} class="small mdi-hardware-mouse liked"></i>
            <i ng-if="userRating < $index + 1" ng-mouseenter="displayRating($index)" ng-mouseleave="resetRatingDisplay()" ng-click="setRating($index)" id={{$index}} class="small mdi-hardware-mouse"></i>
            <md-tooltip ng-if="!$root.isAuthenticated">log in to rate tool</md-tooltip>
          </span>
        </div>
      </div>
    </div>
    <div class="divider"></div>
    <div class="row">

    </div>
    <div class="row">
      <div class="col m10 offset-m1">
        <div class="card-panel blue-grey darken-2">
          <a ng-href="{{tool.tool.web_url}}"><span class="small mdi-social-public"></span><md-tooltip ng-if="tool.tool.web_url">website</md-tooltip><md-tooltip ng-if="!!tool.tool.web_url == false">no website</md-tooltip></a> <a ng-href="{{tool.tool.doc_url}}"><span class="mdi-action-description"></span><md-tooltip ng-if="tool.tool.doc_url">docs</md-tooltip><md-tooltip ng-if="!!tool.tool.doc_url == false">no docs</md-tooltip></a> <a ng-href="{{tool.tool.repo_url}}"><span class="mdi-communication-call-split"></span><md-tooltip ng-if="tool.tool.repo_url">repository</md-tooltip><md-tooltip ng-if="!!tool.tool.repo_url == false">no repo</md-tooltip></a> <a ng-if="$root.isAuthenticated" ng-href="/tools/{{tool.tool.id}}/edit"><span class="mdi-editor-mode-edit"></span><md-tooltip ng-if="$root.isAuthenticated === true">edit this tool</md-tooltip></a><span ng-if="isAuthenticated === false"><span class="mdi-editor-mode-edit"></span><md-tooltip ng-if="$root.isAuthenticated === false">log in to edit</md-tooltip></span>
          <p>{{tool.tool.description}}</p>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col m6">
        <div class="card-panel blue-grey darken-2">
          <h5>Categories</h5>
          <ul class="tool-search-results">
            <li ng-repeat="category in tool.categories" class="tool-search-results">
              <a href="#" class="tool-category">{{category.category}}</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col m6">
        <div class="card-panel blue-grey darken-2">
          <h5>Tags</h5>
          <ul class="tool-search-results">
            <li ng-repeat="tag in tool.tags" class="tool-search-results">
              <a href="#" class="tool-category">{{tag.tag}}</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col m6">
        <div class="card-panel blue-grey darken-2">
          <h5>Information</h5>
          <table>
            <tbody>
              <tr>
                <th>Language</th>
                <td>{{tool.tool.language}}</td>
              </tr>
              <tr>
                <th>Cost</th>
                <td>{{is_free}}</td>
              </tr>
              <tr>
                <th>Source Code</th>
                <td>{{tool.tool.is_open? 'open source' : 'closed source'}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="col m6">
        <div class="card-panel blue-grey darken-2">
          <h5>Links</h5>
          <table>
            <tbody>
              <tr>
                <th class="big-header"><span class="small mdi-social-public"></span><a href="{{tool.tool.web_url}}"> Website</a></th>
                <td></td>
              </tr>
              <tr>
                <th class="big-header"><span class="mdi-action-description"></span><a href="{{tool.tool.doc_url}}"> Documentation</a></th>
                <td></td>
              </tr>
              <tr>
                <th class="big-header"><span class="mdi-communication-call-split"></span><a href="{{tool.tool.repo_url}}"> Repository</a></th>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">

  <div class="col s12 m7 offset-m4 card-panel blue-grey darken-1">
    <div class="row">
      <h3>Reviews</h3>
    </div>

    <div class="row">
      <form>
        <legend>Add a Review</legend>
        <div class="input-field">
          <div class="form-group">
            <textarea id="post" ng-model="post" style="display:none"></textarea>
            <div id="epiceditor"></div>
          </div>
        </div>
        <button ng-click="saveReview()" id="save-comment-btn" class="btn waves-effect waves-light deep-purple lighten-1" type="button">Add Review</button>
      </form>
    </div>

    <div class="row" ng-repeat="review in tool.reviews_users" ng-bind-html-unsafe="review.review.post">
      <div class="card-panel blue-grey darken-2 review">
        <div class="reviewerName">
          {{review.user_name}}
          <span class="reviewTime" am-time-ago="review.review.created_at"></span>
        </div>
        <div markdown="review.review.post"></div>
      </div>
    </div>

  </div>
</div>

<script>

  var opts = {
    container: 'epiceditor',
    textarea: post,
    basePath: '../../',
    clientSideStorage: false,
    localStorageName: 'epiceditor',
    useNativeFullscreen: true,
    parser: marked,
    file: {
      name: 'epiceditor',
      defaultContent: '',
      autoSave: 100
    },
    theme: {
      // base: 'assets/themes/base/epiceditor.css',
      // preview: 'assets/themes/editor/epic-dark.css',
      // editor: 'assets/themes/editor/epic-dark.css'
      base: 'https://rawgit.com/ncronquist/4c9211a66a627286f6c8/raw/562c29dfc024c2cdf21786eeceda55403599bd37/epiceditor.css',
      preview: 'https://rawgit.com/ncronquist/82821f114e29876a7a7c/raw/fffc2a8b6fbcfa0abdef124c784ef1befe1efaba/epic-dark.css',
      editor: 'https://rawgit.com/ncronquist/82821f114e29876a7a7c/raw/fffc2a8b6fbcfa0abdef124c784ef1befe1efaba/epic-dark.css'
    },
    button: {
      preview: false,
      fullscreen: false,
      bar: true
    },
    focusOnLoad: false,
    shortcut: {
      modifier: 18,
      fullscreen: 70,
      preview: 80
    },
    string: {
      togglePreview: 'Toggle Preview Mode',
      toggleEdit: 'Toggle Edit Mode',
      toggleFullscreen: 'Enter Fullscreen'
    },
    autogrow: false
  }
  var editor = new EpicEditor(opts).load();

</script>
